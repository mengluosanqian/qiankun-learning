!function(a,b){a.Parse=b()}(this,function(){function m(a,b){var e,c=Object.create(null),d=a.split(",");for(e=0;e<d.length;e++)c[d[e]]=!0;return b?function(a){return c[a.toLowerCase()]}:function(a){return c[a]}}function p(a){return this._init(a)}function q(a,b){function t(b){h+=b,a=a.substring(b)}function u(){var e,f,g,b=a.match(c);if(b){for(e={tagName:b[1],attrs:[],start:h},t(b[0].length);!(f=a.match(d))&&(g=a.match(k));)t(g[0].length),e.attrs.push(g);if(f)return t(f[0].length),e.end=h,e}}function v(a){var i,k,l,c=a.tagName,d=g(c),e=a.attrs.length,h=new Array(e);for(i=0;e>i;i++)k=a.attrs[i],l=k[3]||k[4]||k[5]||"",h[i]={name:k[1],value:l};d||(f.push({tag:c,lowerCasedTag:c.toLowerCase(),attrs:h}),j=c),b.start&&b.start(c,h,d,a.start,a.end)}function w(a,c,d){var e,g,i;if(null==c&&(c=h),null==d&&(d=h),a&&(g=a.toLowerCase()),a)for(e=f.length-1;e>=0&&f[e].lowerCasedTag!==g;e--);else e=0;if(e>=0){for(i=f.length-1;i>=e;i--)b.end&&b.end(f[i].tag,c,d);f.length=e,j=e&&f[e-1].tag}else"br"===g?b.start&&b.start(a,[],!0,c,d):"p"===g&&(b.start&&b.start(a,[],!1,c,d),b.end&&b.end(a,c,d))}for(var i,j,l,m,o,p,q,r,f=[],g=n,h=0;a;){if(i=a,l=a.indexOf("<"),0===l){if(m=a.match(e)){o=h,t(m[0].length),w(m[1],o,h);continue}if(p=u()){v(p);continue}}q=void 0,r=void 0,l>=0&&(r=a.slice(l),q=a.substring(0,l),t(l)),0>l&&(q=a,a=""),b.chars&&q&&b.chars(q)}}function r(a){var b,c,d=[];return q(a,{start:function(a,e,f){var g={type:1,tag:a,attrsList:e,attrsMap:v(e),parent:b,children:[]};s(g),c||(c=g),b&&(b.children.push(g),g.parent=b),f||(b=g,d.push(g))},end:function(){var a=d[d.length-1],c=a.children[a.children.length-1];c&&3===c.type&&" "===c.text&&!g&&a.children.pop(),d.length-=1,b=d[d.length-1]},chars:function(a){var c,d;b&&(c=b.children,a&&(" "!==a&&(d=u(a))?c.push({type:2,expression:d,text:a}):" "===a&&c.length&&" "===c[c.length-1].text||c.push({type:3,text:a})))}}),c}function s(a){var c,d,e,f,g,b=a.attrsList;for(c=0,d=b.length;d>c;c++)e=f=b[c].name,g=b[c].value,t(a,e,JSON.stringify(g))}function t(a,b,c){(a.attrs||(a.attrs=[])).push({name:b,value:c})}function u(a,b){var d,e,f,g,h,c=b?buildRegex(b):l;if(c.test(a)){for(d=[],e=c.lastIndex=0;f=c.exec(a);)g=f.index,g>e&&d.push(JSON.stringify(a.slice(e,g))),h=f[1].trim(),d.push("_s("+h+")"),e=g+f[0].length;return e<a.length&&d.push(JSON.stringify(a.slice(e))),d.join("+")}}function v(a){var c,d,b={};for(c=0,d=a.length;d>c;c++)b[a[c].name]=a[c].value;return b}var a="[a-zA-Z_][\\w\\-\\.]*",b="((?:"+a+"\\:)?"+a+")",c=new RegExp("^<"+b),d=/^\s*(\/?)>/,e=new RegExp("^<\\/"+b+"[^>]*>"),g=!1,h=/([^\s"'<>\/=]+)/,i=/(?:=)/,j=[/"([^"]*)"+/.source,/'([^']*)'+/.source,/([^\s"'=<>`]+)/.source],k=new RegExp("^\\s*"+h.source+"(?:\\s*("+i.source+")"+"\\s*(?:"+j.join("|")+"))?"),l=/\{\{((?:.|\n)+?)\}\}/g,n=m("area,base,br,col,embed,frame,hr,img,input,isindex,keygen,link,meta,param,source,track,wbr");return p.prototype._init=function(a){return r(a)},p});